await fetch("/api/set-claims", {
    method: "POST",
    headers: {
        "Content-Type": "application/json",
    },
    body: JSON.stringify({
        targetEmail: "someone@example.com",
        role: "admin", // or "instructor"
        requesterEmail: currentUser.email, // e.g., from Firebase
    }),
})


// textx truncation

const [isTruncated, setIsTruncated] = useState(true)

const desc = 'To fill the need of individuals seeking in-demand crypto and blcockchain skills to improve their standard of living and attaining financial freedom by providing excellent hands-on training for a wider variety of students by offering alternate solutions to conventional schooling utilizing current internet technologies and proven teaching practices implemented by a team of professionals in blcockchain, e-commerce, forex, cryptocurrency, social media marketing and motion/graphics industries.'
  

  const handleToggle = () => {
    setIsTruncated(!isTruncated)
  }

  {/* <Desc>To fill the need of individuals seeking in-demand crypto and blcockchain skills to improve their standard of living and attaining financial freedom by providing excellent hands-on training for a wider variety of students by offering alternate solutions to conventional schooling utilizing current internet technologies and proven teaching practices implemented by a team of professionals in blcockchain, e-commerce, forex, cryptocurrency, social media marketing and motion/graphics industries.
        
        </Desc> */}
        {/* <Desc>
          {isTruncated
            ? `${desc.split(' ').slice(0, 40).join(' ')}...`
            : desc}
          {isTruncated && (
            <Seemore onClick={handleToggle}>See more</Seemore>
          )}
          {!isTruncated && (
          <span><Seemore onClick={handleToggle}>See less</Seemore></span>
          )}
        </Desc> */}



  // fetch the user's purchased courses list on load
  // useEffect(() => {
  //   const fetchPurchasedCourses = async () => {
  //     try {
  //       const response = await fetch(`/api/courses/${student}`)
  //       if (response.ok) {
  //         const data = await response.json()
  //         setPurchasedCourses(data)
  //       } else {
  //         setError("Could not fetch purchased courses")
  //       }
  //     } catch (error) {
  //       setError("Could not fetch purchased courses")
  //       console.error(error)
  //     }
  //   }

  //   fetchPurchasedCourses()
  // }, [])



  import { useState } from 'react';
import styled from 'styled-components';

const PlayerContainer = styled.div`
  position: relative;
  width: 100%;
  padding-top: 56.25%; /* 16:9 Aspect Ratio */
`;

const Iframe = styled.iframe`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
`;

const VideoPlayer = ({ href, title, videos, currentIndex, setCurrentIndex }) => {
  const [showNextPrev, setShowNextPrev] = useState(false);

  const showNextVideo = () => {
    if (currentIndex + 1 < videos.length) {
      setCurrentIndex(currentIndex + 1);
    }
  };

  const showPrevVideo = () => {
    if (currentIndex > 0) {
      setCurrentIndex(currentIndex - 1);
    }
  };

  return (
    <div onMouseEnter={() => setShowNextPrev(true)} onMouseLeave={() => setShowNextPrev(false)}>
      <PlayerContainer>
        <Iframe
          width="100%"
          height="100%"
          src={href}
          title={title}
          frameBorder="0"
          allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
          allowFullScreen
        />
      </PlayerContainer>
      {showNextPrev && (
        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', marginTop: 8 }}>
          {currentIndex > 0 && (
            <button onClick={showPrevVideo} style={{ marginRight: 16 }}>
              <svg width="24" height="24" viewBox="0 0 24 24">
                <path fill="#333" d="M15,5.5V18.5L6,12z" />
              </svg>
            </button>
          )}
          {currentIndex + 1 < videos.length && (
            <button onClick={showNextVideo}>
              <svg width="24" height="24" viewBox="0 0 24 24">
                <path fill="#333" d="M9,5.5v13L18,12z" />
              </svg>
            </button>
          )}
        </div>
      )}
    </div>
  );
};


payWithPaystack = () => {
  const handler = window.PaystackPop.setup({
    key: 'your_public_key_here',
    email: 'customer@example.com',
    amount: 10000,
    currency: 'NGN',
    callback: (response) => {
      console.log(response);
      if(response.status === false) {
        alert("Payment failed");
      } else {
        alert("Payment successful");
        // add the item id to enrolledCourses
      }
    },
    onClose: () => {
      alert('Transaction cancelled');
    },
  });
  handler.openIframe();
}

                    {module.links &&
                        Object.entries(module.links).map(([title, url], subIndex) => (
                            <AccordionDetails key={subIndex}>
                                <ModuleContent>
                                    {!enrolled ? (
                                        <LockIcon />
                                    ) : (
                                        <Playbtn
                                            onClick={() => {
                                                if (enrolled) {
                                                    // setSelectedVideo(url)
                                                    // setSelectedTitle(title)
                                                    console.log()
                                                }
                                            }}
                                        />
                                    )}
                                    {title}
                                    {completedVideos.includes(title) ? (
                                        <RoundCheckBox style={{ color: "#0072ff" }} />
                                    ) : (
                                        <RoundCheckBox />
                                    )}

                                    {/* <RoundCheckBox /> */}
                                </ModuleContent>
                            </AccordionDetails>
                        ))}




// export default function InProgressCourses({ userData, limit }: DashboardProps) {
//     // Filter only courses with status "in-progress"
//     // const inProgressCourses = user.enrolledCourses
//     // const { enrolledCourses, loading } = useUserEnrolledCourses(userData.id)
//     // const inProgressCourses = enrolledCourses.filter((c) => c.status === "in progress")

//         const { data: courses, isLoading, error } = useFetchCourses()
//         const { enrolledCourses } = useUserStore()
//         const { user, authReady } = useAuthReady()

//         const enrolledCourseIds = enrolledCourses.map((c) => c.courseId)
//         const coursesToDisplay = (courses ?? [])
//             .filter((course) => enrolledCourseIds.includes(course.id))
//             .slice(0, limit ?? enrolledCourseIds.length)

//         // const coursesToDisplay = (courses ?? [])
//         // .filter((course) => enrolledCourses.some((ec) => ec.courseId === course.id))
//         // .slice(0, limit ?? enrolledCourses.length)

//         console.log("Courses to display: ", coursesToDisplay)
//         console.log("Enrolled course ids to display: ", enrolledCourseIds)
//     // console.log("Courses in progress", inProgressCourses)
//     const comment = " you have no enrolled courses"

//     if (isLoading || !authReady) return <p>Loading...</p>
//     if (error) return <p>Failed to load courses.</p>
//     if (!user) return <p>Please log in to view your learning progress.</p>

//     return (
//         <Container>
//             <CourseList>
//                 {coursesToDisplay &&
//                     coursesToDisplay.map((course) => (
//                         <CourseCard key={course.id}>
//                             <CourseImage
//                                 src={course.image}
//                                 alt={course.title}
//                             />
//                             <CourseInfo>
//                                 <Rating
//                                     name="half-rating-read"
//                                     defaultValue={course.rating}
//                                     precision={1}
//                                     readOnly
//                                 />
//                                 <CourseTitle>{course.title}</CourseTitle>

//                                 <ProgressText>
//                                     Completed Lessons: {.completedLessons} of
//                                     {course.onDemandVideos}
//                                 </ProgressText>
//                                 <ProgressContainer>
//                                     <ProgressBarContainer>
//                                         <ProgressBar $progress={.} />
//                                     </ProgressBarContainer>
//                                     <span>{.progress}% completed</span>
//                                 </ProgressContainer>
//                             </CourseInfo>
//                         </CourseCard>
//                     ))
//                 ) : (
//                     <NoDataAvailable comment={user.name + " " + "sir," + comment} />
//                 )}
//             </CourseList>
//         </Container>
//     )
// }

   // const handleCompletedVideos = async () => {
    //     if (!completedVideos.includes(selectedTitle)) {
    //         const updatedList = [...completedVideos, selectedTitle]
    //         setCompletedVideos(updatedList)

    //         const userId = firebaseUser?.uid
    //         if (!userId) return

    //         // Sync videos watched to Firestore
    //         const courseRef = doc(db, "users", userId, "enrolledCourses", courseId)
    //         // await updateDoc(courseRef, { completedLessons: updatedList.length })
    //         await updateDoc(courseRef, {
    //             completedLessons: updatedList.length,
    //             completedVideos: updatedList,
    //         })

    //         // Ensure enrolled status in Zustand
    //         if (!useUserStore.getState().isEnrolled(courseId)) {
    //             useUserStore.getState().addToEnrolledCourses({
    //                 userId,
    //                 courseId,
    //                 completedLessons: updatedList.length,
    //                 progress: (updatedList.length / videoList.length) * 100,
    //                 status: "in progress",
    //                 enrolledAt: new Date(),
    //             })
    //         }

    //         // If completed all videos
    //         if (updatedList.length === videoList.length) {
    //             const completedCourse: CompletedCourse = {
    //                 userId,
    //                 courseId,
    //                 completedAt: new Date(),
    //             }
    //             await setDoc(
    //                 doc(db, "users", userId, "completedCourses", courseId),
    //                 completedCourse,
    //             )
    //             useUserStore.getState().addToCompletedCourses(completedCourse)
    //             setCertificateReady(true)
    //         }
    //     }
    // }

       useEffect(() => {
        // const fetchCompletedVideos = async () => {
        //     if (!firebaseUser?.uid || !courseId) return

        //     const courseRef = doc(db, "users", firebaseUser.uid, "enrolledCourses", courseId)
        //     const snap = await getDoc(courseRef)

        //     if (snap.exists()) {
        //         const data = snap.data()

        //         if (data.completedVideos && Array.isArray(data.completedVideos)) {
        //             setCompletedVideos(data.completedVideos)
        //         } else {
        //             setCompletedVideos([]) // no saved progress
        //         }
        //     }
        // }
                  setEnrolled(isEnrolled)

            // if (isEnrolled) {
            //     fetchCompletedVideos()
            // }
            // if (isCompleted) {
            //     setCertificateReady(true)
            // }
            // console.log("Is enrolled: ", isEnrolled)
            // console.log("Is Certifcate ready: ", isCompleted)
            // console.log("Complete lessons: ", completedVideos)


            // export async function markInvitePending({
//     userId,
//     email,
//     classId,
//     telegramGroupId,
//     cohortName,
//     className,
// }: Omit<telegramPendingInvites, "attempts" | "status" | "createdAt" | "updatedAt">) {
//     telegramGroupId
//     const enrollmentId = `${userId}-${classId}`

//     const inviteData: telegramPendingInvites = {
//         userId,
//         email,
//         classId,
//         telegramGroupId,
//         cohortName,
//         className,
//         attempts: 0,
//         status: "pending",
//         createdAt: new Date(),
//         updatedAt: new Date(),
//     }

//      await adminDb
//         .collection("telegramPendingInvites")
//         .doc(enrollmentId)
//         .set({
//             ...data,
//             attempts: 0,
//             status: "pending",
//             createdAt: FieldValue.serverTimestamp(),
//             updatedAt: FieldValue.serverTimestamp(),
//         })
//     // await setDoc(doc(db, "telegramPendingInvites", enrollmentId), inviteData)
//     //  await setDoc(doc(db, "telegramPendingInvites", enrollmentId), {
//     //      userId,
//     //      email,
//     //      classId,
//     //      cohortName,
//     //      className,
//     //      telegramGroupId,
//     //      attempts: 0,
//     //      status: "pending",
//     //      createdAt: new Date(),
//     //      updatedAt: new Date(),
//     //  })
// }